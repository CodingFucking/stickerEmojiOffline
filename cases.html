<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Индивидуальные стикеры и эмодзи</title>
    <link rel="stylesheet" href="styles/cases.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.9.4/lottie.min.js"></script>
</head>
<body>
    <div class="content-container">
        <h1>Индивидуальные стикеры и эмодзи</h1>
        <p>Для заказа писать <a href="https://t.me/dzhv_fx" target="_blank">@dzhv_fx</a></p>
        
        <div id="content">
            <div class="main-category">
                <h2>Стикеры</h2>
                <div class="sub-category">
                    <h3>Анимированные</h3>
                    <div class="media-container" id="animated-stickers"></div>
                </div>
                <div class="sub-category">
                    <h3>Видео</h3>
                    <div class="media-container" id="video-stickers"></div>
                </div>
                <div class="sub-category">
                    <h3>Статичные</h3>
                    <div class="media-container" id="static-stickers"></div>
                </div>
            </div>
            
            <div class="main-category">
                <h2>Эмодзи</h2>
                <div class="sub-category">
                    <h3>Анимированные</h3>
                    <div class="media-container" id="animated-emojis"></div>
                </div>
                <div class="sub-category">
                    <h3>Видео</h3>
                    <div class="media-container" id="video-emojis"></div>
                </div>
                <div class="sub-category">
                    <h3>Статичные</h3>
                    <div class="media-container" id="static-emojis"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="media-viewer" id="mediaViewer">
        <span class="close-viewer">&times;</span>
        <div class="media-viewer-content" id="mediaViewerContent"></div>
    </div>

    <script>
        // Полные данные медиафайлов
        const mediaData = {
            "animated-stickers": [
                {name: "s_1.json", path: "assets/_stickers/animated/p1/s_1.json"},
                {name: "s_2.json", path: "assets/_stickers/animated/p1/s_2.json"},
                {name: "s_3.json", path: "assets/_stickers/animated/p1/s_3.json"},
                {name: "s_4.json", path: "assets/_stickers/animated/p1/s_4.json"},
                {name: "s_5.json", path: "assets/_stickers/animated/p1/s_5.json"},
                {name: "s_1.json", path: "assets/_stickers/animated/p2/s_1.json"},
                {name: "s_2.json", path: "assets/_stickers/animated/p2/s_2.json"},
                {name: "s_3.json", path: "assets/_stickers/animated/p2/s_3.json"},
                {name: "s_4.json", path: "assets/_stickers/animated/p2/s_4.json"},
                {name: "s_5.json", path: "assets/_stickers/animated/p2/s_5.json"},
                {name: "s_1.json", path: "assets/_stickers/animated/p3/s_1.json"},
                {name: "s_2.json", path: "assets/_stickers/animated/p3/s_2.json"},
                {name: "s_3.json", path: "assets/_stickers/animated/p3/s_3.json"},
                {name: "s_4.json", path: "assets/_stickers/animated/p3/s_4.json"}
            ],
            "static-stickers": [
                {name: "s_1.webp", path: "assets/_stickers/static/p1/s_1.webp"},
                {name: "s_2.webp", path: "assets/_stickers/static/p1/s_2.webp"},
                {name: "s_3.webp", path: "assets/_stickers/static/p1/s_3.webp"},
                {name: "s_4.webp", path: "assets/_stickers/static/p1/s_4.webp"},
                {name: "s_1.png", path: "assets/_stickers/static/p2/s_1.png"},
                {name: "s_2.png", path: "assets/_stickers/static/p2/s_2.png"},
                {name: "s_3.png", path: "assets/_stickers/static/p2/s_3.png"},
                {name: "s_4.png", path: "assets/_stickers/static/p2/s_4.png"},
                {name: "s_1.webp", path: "assets/_stickers/static/p3/s_1.webp"},
                {name: "s_2.webp", path: "assets/_stickers/static/p3/s_2.webp"},
                {name: "s_3.webp", path: "assets/_stickers/static/p3/s_3.webp"},
                {name: "s_4.webp", path: "assets/_stickers/static/p3/s_4.webp"}
            ],
            "video-stickers": [
                {name: "s_1.webm", path: "assets/_stickers/video/p1/s_1.webm"},
                {name: "s_2.webm", path: "assets/_stickers/video/p1/s_2.webm"},
                {name: "s_3.webm", path: "assets/_stickers/video/p1/s_3.webm"},
                {name: "s_1.webm", path: "assets/_stickers/video/p2/s_1.webm"},
                {name: "s_2.webm", path: "assets/_stickers/video/p2/s_2.webm"},
                {name: "s_3.webm", path: "assets/_stickers/video/p2/s_3.webm"},
                {name: "s_1.webm", path: "assets/_stickers/video/p3/s_1.webm"},
                {name: "s_2.webm", path: "assets/_stickers/video/p3/s_2.webm"},
                {name: "s_3.webm", path: "assets/_stickers/video/p3/s_3.webm"}
            ],
            "animated-emojis": [
                {name: "e_1.json", path: "assets/_emojis/animated/p1/e_1.json"},
                {name: "e_2.json", path: "assets/_emojis/animated/p1/e_2.json"},
                {name: "e_3.json", path: "assets/_emojis/animated/p1/e_3.json"},
                {name: "e_4.json", path: "assets/_emojis/animated/p1/e_4.json"},
                {name: "e_5.json", path: "assets/_emojis/animated/p1/e_5.json"},
                {name: "e_1.json", path: "assets/_emojis/animated/p2/e_1.json"},
                {name: "e_2.json", path: "assets/_emojis/animated/p2/e_2.json"},
                {name: "e_3.json", path: "assets/_emojis/animated/p2/e_3.json"},
                {name: "e_4.json", path: "assets/_emojis/animated/p2/e_4.json"}
            ],
            "static-emojis": [
                {name: "e_1.png", path: "assets/_emojis/static/p1/e_1.png"},
                {name: "e_2.png", path: "assets/_emojis/static/p1/e_2.png"},
                {name: "e_3.png", path: "assets/_emojis/static/p1/e_3.png"},
                {name: "e_4.png", path: "assets/_emojis/static/p1/e_4.png"},
                {name: "e_5.png", path: "assets/_emojis/static/p1/e_5.png"},
                {name: "e_6.png", path: "assets/_emojis/static/p1/e_6.png"},
                {name: "e_7.png", path: "assets/_emojis/static/p1/e_7.png"},
                {name: "e_8.png", path: "assets/_emojis/static/p1/e_8.png"},
                {name: "e_9.png", path: "assets/_emojis/static/p1/e_9.png"},
                {name: "e_10.png", path: "assets/_emojis/static/p1/e_10.png"},
                {name: "e_11.png", path: "assets/_emojis/static/p1/e_11.png"},
                {name: "e_12.png", path: "assets/_emojis/static/p1/e_12.png"},
                {name: "e_13.png", path: "assets/_emojis/static/p1/e_13.png"},
                {name: "e_14.png", path: "assets/_emojis/static/p1/e_14.png"},
                {name: "e_15.png", path: "assets/_emojis/static/p1/e_15.png"}
            ],
            "video-emojis": [
                {name: "e_1.webm", path: "assets/_emojis/video/p1/e_1.webm"},
                {name: "e_2.webm", path: "assets/_emojis/video/p1/e_2.webm"},
                {name: "e_3.webm", path: "assets/_emojis/video/p1/e_3.webm"},
                {name: "e_4.webm", path: "assets/_emojis/video/p1/e_4.webm"},
                {name: "e_5.webm", path: "assets/_emojis/video/p1/e_5.webm"},
                {name: "e_1.webm", path: "assets/_emojis/video/p2/e_1.webm"},
                {name: "e_2.webm", path: "assets/_emojis/video/p2/e_2.webm"},
                {name: "e_3.webm", path: "assets/_emojis/video/p2/e_3.webm"},
                {name: "e_4.webm", path: "assets/_emojis/video/p2/e_4.webm"},
                {name: "e_5.webm", path: "assets/_emojis/video/p2/e_5.webm"},
                {name: "e_1.webm", path: "assets/_emojis/video/p3/e_1.webm"},
                {name: "e_2.webm", path: "assets/_emojis/video/p3/e_2.webm"},
                {name: "e_3.webm", path: "assets/_emojis/video/p3/e_3.webm"},
                {name: "e_4.webm", path: "assets/_emojis/video/p3/e_4.webm"},
                {name: "e_5.webm", path: "assets/_emojis/video/p3/e_5.webm"},
                {name: "e_1.webm", path: "assets/_emojis/video/p4/e_1.webm"},
                {name: "e_2.webm", path: "assets/_emojis/video/p4/e_2.webm"},
                {name: "e_3.webm", path: "assets/_emojis/video/p4/e_3.webm"},
                {name: "e_4.webm", path: "assets/_emojis/video/p4/e_4.webm"},
                {name: "e_5.webm", path: "assets/_emojis/video/p4/e_5.webm"}
            ]
        };

        // Глобальные элементы
        const contentDiv = document.getElementById("content");
        const mediaViewer = document.getElementById("mediaViewer");
        const mediaViewerContent = document.getElementById("mediaViewerContent");
        const closeViewer = document.querySelector(".close-viewer");

        // Определение окружения (локально или на GitHub Pages)
        const isGitHub = window.location.host.includes('github.io');
        const basePath = isGitHub ? `/${window.location.pathname.split('/')[1]}` : '';

        // Функция для корректировки путей к файлам
        function getCorrectedPath(originalPath) {
            return originalPath.startsWith('assets/') && isGitHub 
                ? `${basePath}/${originalPath}` 
                : originalPath;
        }

        // Заполняем контейнеры медиафайлами
        Object.entries(mediaData).forEach(([containerId, items]) => {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            items.forEach(item => {
                const mediaItem = document.createElement("div");
                mediaItem.classList.add("media-item");
                
                const correctedPath = getCorrectedPath(item.path);
                const finalPath = `${correctedPath}?v=${Date.now()}`;
                
                if (item.path.endsWith(".webm")) {
                    const video = document.createElement("video");
                    video.src = finalPath;
                    video.loop = true;
                    video.muted = true;
                    video.playsInline = true;
                    video.autoplay = true; // Автовоспроизведение
                    video.preload = "auto";
                    mediaItem.appendChild(video);
                    
                    // Запускаем видео, если оно не началось автоматически
                    video.onloadeddata = () => {
                        video.play().catch(e => console.log("Autoplay prevented:", e));
                    };
                    
                } else if (item.path.endsWith(".json")) {
                    const animContainer = document.createElement("div");
                    animContainer.classList.add("lottie-container");
                    
                    fetch(finalPath)
                        .then(response => response.json())
                        .then(data => {
                            lottie.loadAnimation({
                                container: animContainer,
                                renderer: 'svg',
                                loop: true,
                                autoplay: true, // Автовоспроизведение
                                animationData: data
                            });
                        })
                        .catch(error => {
                            console.error(`Error loading animation: ${finalPath}`, error);
                            animContainer.innerHTML = '<div class="error">Error loading animation</div>';
                        });
                    mediaItem.appendChild(animContainer);
                    
                } else if (item.path.endsWith(".png") || item.path.endsWith(".webp")) {
                    const img = document.createElement("img");
                    img.src = finalPath;
                    img.alt = item.name;
                    img.loading = "lazy";
                    img.onerror = () => {
                        img.src = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23f5f5f5'/><text x='50%' y='50%' font-family='Arial' font-size='10' text-anchor='middle' dominant-baseline='middle' fill='%23aaa'>Image</text></svg>";
                    };
                    mediaItem.appendChild(img);
                }

                mediaItem.addEventListener('click', () => openMediaViewer(item, finalPath));
                container.appendChild(mediaItem);
            });
        });

        // Функция открытия просмотра
        function openMediaViewer(mediaItem, finalPath) {
            // Очищаем предыдущий контент
            mediaViewerContent.innerHTML = '';
            
            // Создаем новый элемент для просмотра
            let viewerElement;
            if (mediaItem.path.endsWith(".webm")) {
                viewerElement = document.createElement("video");
                viewerElement.src = finalPath;
                viewerElement.autoplay = true;
                viewerElement.loop = true;
                viewerElement.controls = true;
                viewerElement.style.maxWidth = '100%';
                viewerElement.style.maxHeight = '80vh';
                
            } else if (mediaItem.path.endsWith(".png") || mediaItem.path.endsWith(".webp")) {
                viewerElement = document.createElement("img");
                viewerElement.src = finalPath;
                viewerElement.style.maxWidth = '100%';
                viewerElement.style.maxHeight = '80vh';
                
            } else if (mediaItem.path.endsWith(".json")) {
                viewerElement = document.createElement("div");
                viewerElement.classList.add("lottie-container");
                viewerElement.style.width = '100%';
                viewerElement.style.maxWidth = '300px';
                viewerElement.style.height = 'auto';
                viewerElement.style.aspectRatio = '1/1';
                
                fetch(finalPath)
                    .then(response => response.json())
                    .then(animationData => {
                        lottie.loadAnimation({
                            container: viewerElement,
                            renderer: 'svg',
                            loop: true,
                            autoplay: true,
                            animationData: animationData
                        });
                    })
                    .catch(error => {
                        console.error('Error loading animation:', error);
                        viewerElement.innerHTML = '<div class="error">Error loading animation</div>';
                    });
            }

            mediaViewerContent.appendChild(viewerElement);
            mediaViewer.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            if (/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                document.body.style.position = 'fixed';
                document.body.style.width = '100%';
            }
        }

        // Закрытие просмотра
        function closeMediaViewer() {
            mediaViewer.classList.remove('active');
            document.body.style.overflow = 'auto';
            document.body.style.position = '';
            document.body.style.width = '';
            
            // Останавливаем видео при закрытии
            const video = mediaViewerContent.querySelector('video');
            if (video) {
                video.pause();
                video.currentTime = 0;
            }
            
            // Перезагружаем миниатюрные видео
            document.querySelectorAll('.media-container video').forEach(v => {
                v.load();
                v.play().catch(e => console.log("Autoplay prevented:", e));
            });
        }

        // Обработчики событий
        closeViewer.addEventListener('click', closeMediaViewer);
        mediaViewer.addEventListener('click', (e) => {
            if (e.target === mediaViewer) {
                closeMediaViewer();
            }
        });

        // Получаем параметр темы из URL
        const urlParams = new URLSearchParams(window.location.search);
        const theme = urlParams.get('theme');

        // Применяем тему
        document.body.classList.toggle('dark-theme', theme === 'dark');

        // Функции для работы с iframe
        window.addEventListener('load', sendHeight);
        new ResizeObserver(sendHeight).observe(document.body);

        window.addEventListener('message', function(event) {
            if (event.data.type === 'requestHeight' && event.data.id === window.frameElement?.id) {
                sendHeight();
            }
        });

        function sendHeight() {
            const height = document.documentElement.scrollHeight;
            window.parent.postMessage({
                type: 'iframeHeight',
                height: height,
                id: window.frameElement?.id
            }, '*');
        }

        // Автозапуск всех видео после загрузки страницы
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.querySelectorAll('.media-container video').forEach(video => {
                    video.play().catch(e => console.log("Autoplay prevented:", e));
                });
            }, 1000);
        });
    </script>
</body>
</html>
